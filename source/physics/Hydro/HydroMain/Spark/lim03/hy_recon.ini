[hy_recon_declare]
definition=
  real :: del_p,del_m,lim_p,lim_m,delbar
  real :: dupw,dloc,delta, lim_f
  real, parameter :: epsilon = 1.0e-16
  real, parameter :: epsinv = 1.0/epsilon
  real, parameter :: onethird=1./3.
  real :: eta, theta, q, phi


[hy_recon]
definition=
   lim_f = 1.0/(hy_limRad*hy_del(dir))**2
   ! First compute undivided differences
   del_p = hy_rope(v,i+1,j,k) - hy_rope(v,i  ,j,k)
   del_m = hy_rope(v,i  ,j,k) - hy_rope(v,i-1,j,k)
   eta = (del_m**2 + del_p**2)*lim_f
   ! Plus side limiter function
   theta = del_m/(del_p+1.0e-16)
   q = (2.+theta)*onethird
   phi = max(0., min( q, max(-0.5*theta, &
       minval((/2.*theta, q, 1.6/))) ))
   if(eta .le. 1.-epsilon) then
      lim_p = q
   elseif (eta .ge. 1.+epsilon) then
      lim_p = phi
   else
      lim_p =  0.5*((1.0 - (eta-1.0)*epsinv)*q &
            +          (1.0 + (eta-1.0)*epsinv)*phi)
   end if
  ! Minus side limiter function
  theta = del_p/(del_m+1.0e-16)
  q = (2.+theta)*onethird
  phi = max(0., min( q, max(-0.5*theta, &
       minval((/2.*theta, q, 1.6/))) ))
  if (eta .le. 1.-epsilon) then
     lim_m = q
  else if (eta .ge. 1.+epsilon) then
     lim_m = phi
  else
     lim_m =  0.5*((1.0 - (eta-1.0)*epsinv)*q &
           +          (1.0 + (eta-1.0)*epsinv)*phi)
  end if
  ! Interpolate to plus side of zone
  hy_uPlus(v,i,j,k)  = hy_rope(v,i,j,k) + 0.5*lim_p*del_p
  ! Interpolate to minus side of zone
  hy_uMinus(v,i,j,k) = hy_rope(v,i,j,k) - 0.5*lim_m*del_m
  ! Now ensure positivity of density and pressure
  ! Switch to second-order MINMOD for ALL variables
  if (hy_uPlus(HY_DENS,i,j,k) < 0.0 .OR. hy_uMinus(HY_DENS,i,j,k) < 0.0 &
       .OR. hy_uPlus(HY_PRES,i,j,k) < 0.0 .OR. hy_uMinus(HY_PRES,i,j,k) < 0.0 &
       .OR. hy_uPlus(HY_RHOE,i,j,k) < 0.0 .OR. hy_uMinus(HY_RHOE,i,j,k) < 0.0) then
     delbar =0.5 *(sign(1.,del_p) + sign(1.,del_m))*min(abs(del_p),abs(del_m))
     hy_uPlus(v,i,j,k)  = hy_rope(v,i,j,k) + 0.5*delbar
     hy_uMinus(v,i,j,k) = hy_rope(v,i,j,k) - 0.5*delbar
  endif


