##python:genLines

def genLines(setupvars):
    # This is not yet under official testing and its functionality is presently
    # limited to pseudo-UG.  Also, the interfaces will go through serious
    # changes.
    yield 'UNOFFICIAL'

    yield 'PPDEFINE FLASHX_ORCHESTRATION_MILHOJA'

    # No need for 'LIBRARY milhoja' since the Milhoja Grid implementation should
    # already declare that

    # Only works with the Flash-X Milhoja Grid implementation
    if 'Grid' not in setupvars:
        yield 'SETUPERROR Grid setup variable not set'
    if setupvars['Grid'].lower() != 'milhoja':
        yield 'SETUPERROR Milhoja runtime must use the Milhoja Grid implementation'
    yield 'REQUIRES Grid/GridMain/AMR/Milhoja'

    # Users must specify runtime variant
    #   - (grid backend, runtime backend, offloading)
    #   - assume that the Milhoja Grid implementation gets "grid backend" independently
    if 'Milhoja' not in setupvars:
        yield 'SETUPERROR Milhoja setup variable not set'
    milhoja = [e.lower() for e in setupvars['Milhoja'].split(',')]
    if len(milhoja) != 3:
        yield 'SETUPERROR Invalid N Milhoja specification values'
    _, runtime_backend, offload = milhoja

    if   runtime_backend == 'none':
        pass
    elif runtime_backend == 'cuda':
        yield 'LIBRARY CUDA'
        yield 'PPDEFINE ORCHESTRATION_USE_GPUS'
    else:
        yield f'SETUPERROR Invalid Milhoja runtime backend {runtime_backend}'

    if   offload == 'none':
        pass
    elif offload == 'openacc':
        yield 'LIBRARY OACC'
        yield 'PPDEFINE ORCHESTRATION_OPENACC_OFFLOAD'
    else:
        yield f'SETUPERROR Invalid Milhoja computation offloading {offload}'

    yield 'D or_nThreadTeams         N thread teams to create'
    yield 'D or_nThreadsPerTeam      N threads that each team has available upon creation'
    yield 'D or_nStreams             N streams for coordinating data transfers and kernel launches'
    yield 'D or_nBytesInMemoryPools  memory in bytes that each memory pool should manage'
    yield 'PARAMETER or_nThreadTeams        INTEGER 1   [ 1 ... ]'
    yield 'PARAMETER or_nThreadsPerTeam     INTEGER 1   [ 1 ... ]'
    yield 'PARAMETER or_nStreams            INTEGER 0   [ 0 ... ]'
    # This should be an integer.  However, normal values will likely exceed a 32-bit
    # integer.  Therefore, set as a real and let the unit implementation cast
    # to an appropriately-sized integer.
    yield 'PARAMETER or_nBytesInMemoryPools REAL    0.0 [ 0.0 ... ]'

